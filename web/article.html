<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Article Detail - NewsBalancer">
    <meta name="author" content="NewsBalancer">
    <meta name="robots" content="index, follow">

    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline' fonts.googleapis.com; font-src 'self' fonts.gstatic.com; script-src 'self'; connect-src 'self'; img-src 'self' data:;">
    <meta http-equiv="Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">

    <!-- CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <title>Article Detail - NewsBalancer</title>
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header with Navigation -->
    <header class="header" role="banner">
        <nav class="container" aria-label="Main navigation">
            <div class="flex items-center justify-between py-4">
                <div class="nav-brand">
                    <a href="/articles" class="text-2xl font-bold text-primary">
                        NewsBalancer
                    </a>
                </div>
                <ul class="flex space-x-6" role="menubar">
                    <li role="none">
                        <a href="/articles"
                           role="menuitem"
                           class="nav-link">
                            Articles
                        </a>
                    </li>
                    <li role="none">
                        <a href="/admin"
                           role="menuitem"
                           class="nav-link">
                            Admin
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="container py-8" role="main">
        <!-- Breadcrumb Navigation -->
        <nav aria-label="Breadcrumb" class="mb-6">
            <ol class="breadcrumb flex items-center space-x-2 text-sm">
                <li><a href="/articles" class="breadcrumb-link">Articles</a></li>
                <li aria-hidden="true" class="breadcrumb-separator">›</li>
                <li aria-current="page" class="breadcrumb-current">Article Detail</li>
            </ol>
        </nav>

        <!-- Article Header -->
        <article class="article-detail" role="article">
            <header class="article-header mb-8">
                <h1 class="article-title text-4xl font-bold mb-4" id="article-title">
                    Loading article...
                </h1>

                <div class="article-meta flex flex-wrap items-center gap-4 text-sm text-secondary mb-6">
                    <div class="meta-item">
                        <span class="meta-label">Source:</span>
                        <span class="meta-value" id="article-source">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Published:</span>
                        <time class="meta-value" id="article-date" datetime="">-</time>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Reading Time:</span>
                        <span class="meta-value" id="article-reading-time">-</span>
                    </div>
                    <div class="meta-item">
                        <a href="#" id="article-original-link" class="external-link" target="_blank" rel="noopener noreferrer">
                            View Original Article
                            <span class="sr-only">(opens in new window)</span>
                        </a>
                    </div>
                </div>
            </header>

            <!-- Bias Analysis Section -->
            <section class="bias-analysis mb-8 p-6 bg-secondary rounded-lg" aria-labelledby="bias-analysis-title">
                <h2 id="bias-analysis-title" class="text-xl font-semibold mb-4">Bias Analysis</h2>

                <!-- Main Bias Slider -->
                <div class="bias-main mb-6">
                    <h3 class="text-lg font-medium mb-3">Overall Bias Score</h3>
                    <div class="bias-slider-container">
                        <!-- BiasSlider component will be inserted here -->
                        <div id="main-bias-slider"
                             data-article-id=""
                             data-readonly="false"
                             class="bias-slider-placeholder">
                            <div class="loading-placeholder">Loading bias analysis...</div>
                        </div>
                    </div>
                    <div class="bias-explanation text-sm text-secondary mt-2">
                        <p>-1.0 = Strong Left Bias • 0.0 = Neutral • +1.0 = Strong Right Bias</p>
                    </div>
                </div>

                <!-- Individual Model Scores -->
                <div class="model-scores mb-6">
                    <h3 class="text-lg font-medium mb-3">Individual Model Analysis</h3>
                    <div class="model-grid grid grid-cols-1 md:grid-cols-2 gap-4" id="model-scores-container">
                        <!-- Model score cards will be dynamically loaded here -->
                        <div class="loading-placeholder">Loading model scores...</div>
                    </div>
                </div>

                <!-- Confidence Indicators -->
                <div class="confidence-indicators mb-6">
                    <h3 class="text-lg font-medium mb-3">Analysis Confidence</h3>
                    <div class="confidence-grid grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="confidence-item">
                            <div class="confidence-label text-sm text-secondary">Overall Confidence</div>
                            <div class="confidence-value text-lg font-medium" id="overall-confidence">-%</div>
                            <div class="confidence-bar mt-1">
                                <div class="confidence-bar-fill" id="overall-confidence-bar"></div>
                            </div>
                        </div>
                        <div class="confidence-item">
                            <div class="confidence-label text-sm text-secondary">Model Agreement</div>
                            <div class="confidence-value text-lg font-medium" id="model-agreement">-%</div>
                            <div class="confidence-bar mt-1">
                                <div class="confidence-bar-fill" id="model-agreement-bar"></div>
                            </div>
                        </div>
                        <div class="confidence-item">
                            <div class="confidence-label text-sm text-secondary">Data Quality</div>
                            <div class="confidence-value text-lg font-medium" id="data-quality">-%</div>
                            <div class="confidence-bar mt-1">
                                <div class="confidence-bar-fill" id="data-quality-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Scoring Controls (Admin Feature) -->
                <div class="manual-scoring hidden" id="manual-scoring-section" aria-labelledby="manual-scoring-title">
                    <h3 id="manual-scoring-title" class="text-lg font-medium mb-3">Manual Scoring</h3>
                    <form class="manual-scoring-form" id="manual-scoring-form">
                        <fieldset>
                            <legend class="sr-only">Manual bias score adjustment</legend>

                            <div class="form-group mb-4">
                                <label for="manual-bias-score" class="form-label">
                                    Bias Score (-1 to 1):
                                </label>
                                <input type="number"
                                       id="manual-bias-score"
                                       class="form-input"
                                       min="-1"
                                       max="1"
                                       step="0.1"
                                       aria-describedby="manual-bias-help"
                                       required>
                                <div id="manual-bias-help" class="form-help">
                                    -1 = Strong left bias, 0 = Neutral, 1 = Strong right bias
                                </div>
                                <div class="form-error" aria-live="polite"></div>
                            </div>

                            <div class="form-group mb-4">
                                <label for="manual-notes" class="form-label">
                                    Notes (optional):
                                </label>
                                <textarea id="manual-notes"
                                          class="form-textarea"
                                          maxlength="1000"
                                          aria-describedby="manual-notes-count"
                                          rows="3"></textarea>
                                <div id="manual-notes-count" class="form-help">0 / 1000 characters</div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    Update Bias Score
                                </button>
                                <button type="button" class="btn btn-secondary" id="cancel-manual-scoring">
                                    Cancel
                                </button>
                            </div>
                        </fieldset>
                    </form>
                </div>

                <!-- Re-analysis Controls -->
                <div class="reanalysis-controls">
                    <h3 class="text-lg font-medium mb-3">Re-analysis</h3>
                    <div class="flex gap-4">
                        <button type="button" class="btn btn-outline" id="trigger-reanalysis">
                            Re-analyze Article
                        </button>
                        <button type="button" class="btn btn-outline" id="show-manual-scoring">
                            Manual Override
                        </button>
                    </div>

                    <!-- Progress indicator for re-analysis -->
                    <div class="reanalysis-progress hidden mt-4" id="reanalysis-progress">
                        <!-- ProgressIndicator component will be inserted here -->
                        <div class="progress-placeholder">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="progress-text text-sm text-secondary mt-2">
                                Starting analysis...
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Article Content -->
            <section class="article-content" aria-labelledby="article-content-title">
                <h2 id="article-content-title" class="sr-only">Article Content</h2>

                <!-- Article Summary -->
                <div class="article-summary mb-6 p-4 bg-tertiary rounded-lg">
                    <h3 class="text-lg font-medium mb-2">Summary</h3>
                    <p id="article-summary" class="text-secondary">
                        Loading article summary...
                    </p>
                </div>

                <!-- Full Article Content -->
                <div class="article-body prose prose-lg max-w-none" id="article-content">
                    <div class="loading-placeholder">
                        Loading article content...
                    </div>
                </div>
            </section>

            <!-- Feedback Section -->
            <section class="feedback-section mt-12 p-6 bg-secondary rounded-lg" aria-labelledby="feedback-title">
                <h2 id="feedback-title" class="text-xl font-semibold mb-4">Feedback</h2>
                <p class="text-secondary mb-4">
                    Help us improve our bias detection by providing feedback on this analysis.
                </p>

                <form class="feedback-form" id="feedback-form">
                    <fieldset>
                        <legend class="sr-only">Article feedback form</legend>

                        <div class="form-group mb-4">
                            <label class="form-label">How accurate is the bias analysis?</label>
                            <div class="rating-group flex gap-4 mt-2" role="radiogroup" aria-labelledby="feedback-title">
                                <label class="rating-option">
                                    <input type="radio" name="accuracy" value="1" class="sr-only">
                                    <span class="rating-star" aria-label="1 star - Very inaccurate">★</span>
                                </label>
                                <label class="rating-option">
                                    <input type="radio" name="accuracy" value="2" class="sr-only">
                                    <span class="rating-star" aria-label="2 stars - Inaccurate">★</span>
                                </label>
                                <label class="rating-option">
                                    <input type="radio" name="accuracy" value="3" class="sr-only">
                                    <span class="rating-star" aria-label="3 stars - Neutral">★</span>
                                </label>
                                <label class="rating-option">
                                    <input type="radio" name="accuracy" value="4" class="sr-only">
                                    <span class="rating-star" aria-label="4 stars - Accurate">★</span>
                                </label>
                                <label class="rating-option">
                                    <input type="radio" name="accuracy" value="5" class="sr-only">
                                    <span class="rating-star" aria-label="5 stars - Very accurate">★</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group mb-4">
                            <label for="feedback-comments" class="form-label">
                                Additional Comments (optional):
                            </label>
                            <textarea id="feedback-comments"
                                      class="form-textarea"
                                      maxlength="500"
                                      aria-describedby="feedback-comments-count"
                                      rows="3"
                                      placeholder="Share your thoughts on the bias analysis..."></textarea>
                            <div id="feedback-comments-count" class="form-help">0 / 500 characters</div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                Submit Feedback
                            </button>
                        </div>
                    </fieldset>
                </form>
            </section>
        </article>
    </main>

    <!-- Footer -->
    <footer class="footer mt-16 py-8 border-t" role="contentinfo">
        <div class="container">
            <div class="text-center text-sm text-secondary">
                <p>&copy; 2025 NewsBalancer. All rights reserved.</p>
                <p class="mt-2">
                    <a href="/about" class="footer-link">About</a> •
                    <a href="/privacy" class="footer-link">Privacy</a> •
                    <a href="/terms" class="footer-link">Terms</a>
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="/js/main.js" defer></script>
    <script src="/js/pages/article-detail.js" defer></script>
</body>
</html>
